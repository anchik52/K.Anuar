<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Text Search App</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    textarea { width: 100%; height: 200px; }
    input, button { padding: 0.5em; margin-top: 1em; width: 100%; }
    pre { background: #f4f4f4; padding: 1em; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Text Search App (Python in Browser)</h1>

  <textarea id="text-input" placeholder="Paste your text here..."></textarea>

  <input type="text" id="query-input" placeholder="Enter search query (AND, OR, NOT) or word">
  <button onclick="runSearch()">Run Search</button>

  <h3>Results:</h3>
  <pre id="output"></pre>

  <script type="text/python" id="python-script">
import re

def clean_text(lines):
    cleaned = []
    for line in lines:
        line = line.strip().lower()
        line = line.replace(",", "").replace(".", "")
        if line:
            cleaned.append(line)
    return cleaned

def search_text(lines, query):
    if " AND " in query:
        terms = query.split(" AND ")
        return [line for line in lines if all(term in line for term in terms)]
    elif " OR " in query:
        terms = query.split(" OR ")
        return [line for line in lines if any(term in line for term in terms)]
    elif " NOT " in query:
        term1, term2 = query.split(" NOT ")
        return [line for line in lines if term1 in line and term2 not in line]
    else:
        pattern = re.compile(re.escape(query), re.IGNORECASE)
        return [line for line in lines if pattern.search(line)]
  </script>

  <script>
    let pyodideReady = loadPyodide();
    async function runSearch() {
      let pyodide = await pyodideReady;
      await pyodide.loadPackagesFromImports(document.getElementById("python-script").text);
      pyodide.runPython(document.getElementById("python-script").text);

      let text = document.getElementById("text-input").value;
      let query = document.getElementById("query-input").value.toLowerCase();
      let lines = text.split("\n");

      pyodide.globals.set("lines", lines);
      pyodide.globals.set("query", query);
      let result = pyodide.runPython(`cleaned = clean_text(lines)\nsearch_text(cleaned, query)`);
      document.getElementById("output").textContent = result.join("\n");
    }
  </script>
</body>
</html>
